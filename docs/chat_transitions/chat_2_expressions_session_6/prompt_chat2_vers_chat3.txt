# ğŸ”„ Prompt de transition : Chat 2 â†’ Chat 3

**Date de transition :** 19 octobre 2025  
**Chat prÃ©cÃ©dent :** Chat 2 - Session 6 : Expressions faciales VRM  
**Chat suivant :** Chat 3 - Session 7 : Transitions smooth et animations

---

## ğŸ“‹ Contexte du projet

Tu travailles sur **Desktop-Mate**, une application hybride Python + Unity qui affiche un avatar VRM interactif sur le bureau Windows.

**Objectif global :** CrÃ©er un assistant virtuel personnalisÃ© qui peut parler, rÃ©agir Ã©motionnellement et se dÃ©placer librement sur le bureau.

---

## âœ… Ã‰tat actuel du projet (fin Chat 2)

### Sessions complÃ©tÃ©es (0-6)

| Session | Objectif | Status |
|---------|----------|--------|
| Session 0 | Configuration Git Unity | âœ… TerminÃ©e |
| Session 1 | Setup projet Python/Unity | âœ… TerminÃ©e |
| Session 2 | Installation Unity | âœ… TerminÃ©e |
| Session 3 | Installation UniVRM | âœ… TerminÃ©e |
| Session 4 | Connexion Python â†” Unity (IPC) | âœ… TerminÃ©e |
| Session 5 | Chargement modÃ¨le VRM | âœ… TerminÃ©e |
| **Session 6** | **Expressions faciales** | âœ… **100% TERMINÃ‰E** |

### FonctionnalitÃ©s opÃ©rationnelles

**Infrastructure (Sessions 0-5) :**
- âœ… Projet Unity 2022.3 LTS (URP)
- âœ… UniVRM 0.127.3 installÃ©
- âœ… Interface Python PySide6 avec onglets
- âœ… Communication IPC via socket TCP (port 5555)
- âœ… Chargement VRM depuis Python vers Unity
- âœ… Thread-safety Unity (Queue<Action> + Update)

**Expressions faciales (Session 6) â­ NOUVEAU :**
- âœ… VRMBlendshapeController.cs VERSION 1.6 (330+ lignes)
- âœ… 5 expressions fonctionnelles :
  - ğŸ˜Š Joy (Joyeux)
  - ğŸ˜  Angry (En colÃ¨re)
  - ğŸ˜¢ Sorrow (Triste)
  - ğŸ˜„ Fun (AmusÃ©)
  - ğŸ˜² Surprised (Surpris)
- âœ… Interface Python avec sliders 0-100%
- âœ… Bouton "Reset All Expressions"
- âœ… Update en temps rÃ©el (IPC + rendering)

---

## ğŸ—ï¸ Architecture technique actuelle

```
Python Qt (PySide6)
â”œâ”€ TabWidget
â”‚  â”œâ”€ Connection (load VRM)
â”‚  â””â”€ Expressions â­
â”‚     â”œâ”€ 5 sliders (Joy, Angry, Sorrow, Fun, Surprised)
â”‚     â””â”€ Reset All button
â”‚
â””â”€ UnityBridge (unity_bridge.py)
   â”œâ”€ connect_to_unity()
   â”œâ”€ load_vrm_model(path)
   â”œâ”€ set_expression(name, value) â­
   â””â”€ reset_expressions() â­
        â”‚
        â”‚ TCP Socket (port 5555)
        â”‚ JSON: {"command": "...", "data": {...}}
        â”‚
        â–¼
Unity Engine (2022.3 LTS)
â”œâ”€ PythonBridge.cs
â”‚  â”œâ”€ StartServer() : port 5555
â”‚  â”œâ”€ HandleMessage(json)
â”‚  â””â”€ Commands: load_model, set_expression, reset_expressions
â”‚
â”œâ”€ VRMLoader.cs
â”‚  â””â”€ LoadVRMModel(path)
â”‚
â””â”€ VRMBlendshapeController.cs â­ VERSION 1.6
   â”œâ”€ SetExpression(name, value)  [Thread-safe]
   â”œâ”€ ResetExpressions()
   â”œâ”€ Update()  [ExÃ©cute Queue<Action>]
   â””â”€ LateUpdate()  [Apply() garanti chaque frame]
        â”‚
        â–¼
   VRMBlendShapeProxy (UniVRM)
   â”œâ”€ ImmediatelySetValue(key, value)
   â””â”€ Apply() â† CRITIQUE !
        â”‚
        â–¼
   Avatar VRM (Mura Mura - Model)
   ğŸ­ Affiche expressions ! ğŸ˜ŠğŸ˜ ğŸ˜¢ğŸ˜„ğŸ˜²
```

---

## ğŸ”‘ Code clÃ© Ã  connaÃ®tre (VERSION FINALE)

### VRMBlendshapeController.cs (VERSION 1.6)

**Localisation :** `unity/DesktopMateUnity/Assets/Scripts/VRMBlendshapeController.cs`

**Points critiques :**

#### 1. Deux mÃ©thodes pour crÃ©er BlendShapeKey

**Expressions VRM standard (presets) :**
```csharp
// Joy, Angry, Sorrow, Fun utilisent CreateFromPreset()
BlendShapePreset? preset = null;
switch (expressionName.ToLower())
{
    case "joy": preset = BlendShapePreset.Joy; break;
    case "angry": preset = BlendShapePreset.Angry; break;
    case "sorrow": preset = BlendShapePreset.Sorrow; break;
    case "fun": preset = BlendShapePreset.Fun; break;
}

if (preset.HasValue)
{
    key = BlendShapeKey.CreateFromPreset(preset.Value);
}
```

**Expressions custom (non-standard) :**
```csharp
// Surprised utilise CreateUnknown() avec CASSE IMPORTANTE
else
{
    string capitalizedName = char.ToUpper(expressionName[0]) + expressionName.Substring(1).ToLower();
    key = BlendShapeKey.CreateUnknown(capitalizedName); // "Surprised" pas "surprised"
}
```

âš ï¸ **IMPORTANT :** CreateUnknown() est **case-sensitive** !

---

#### 2. Apply() obligatoire Ã  DEUX endroits

**Appel 1 : Dans SetExpressionInternal() - Application immÃ©diate**
```csharp
blendShapeProxy.ImmediatelySetValue(key, value);
blendShapeProxy.Apply(); // â† Flush le buffer
```

**Appel 2 : Dans LateUpdate() - Garantie de rendu**
```csharp
void LateUpdate()
{
    if (blendShapeProxy != null)
    {
        blendShapeProxy.Apply(); // â† Assure rendu chaque frame
    }
}
```

âš ï¸ **IMPORTANT :** Sans les deux Apply(), les expressions peuvent ne pas s'afficher !

---

#### 3. Thread-safety avec Queue<Action>

```csharp
private Queue<Action> actionQueue = new Queue<Action>();

// Thread IPC appelle ceci (thread-safe)
public void SetExpression(string expressionName, float value)
{
    actionQueue.Enqueue(() => SetExpressionInternal(expressionName, value));
}

// Main thread Unity exÃ©cute
void Update()
{
    while (actionQueue.Count > 0)
    {
        Action action = actionQueue.Dequeue();
        action.Invoke();
    }
}
```

âš ï¸ **IMPORTANT :** Unity API (GameObject, BlendShapeProxy) interdit sur threads secondaires !

---

#### 4. Fallback automatique pour robustesse

```csharp
// VÃ©rification aprÃ¨s Apply()
float actualValue = blendShapeProxy.GetValue(key);

if (actualValue < 0.01f && value > 0.0f)
{
    // Le preset ne fonctionne pas, essayer avec nom capitalisÃ©
    string capitalizedName = char.ToUpper(expressionName[0]) + expressionName.Substring(1).ToLower();
    key = BlendShapeKey.CreateUnknown(capitalizedName);
    
    blendShapeProxy.ImmediatelySetValue(key, value);
    blendShapeProxy.Apply();
}
```

Cette logique amÃ©liore la compatibilitÃ© avec diffÃ©rents modÃ¨les VRM.

---

### Python API (unity_bridge.py)

**Nouvelles mÃ©thodes ajoutÃ©es en Session 6 :**

```python
def set_expression(self, expression_name: str, value: float) -> bool:
    """
    DÃ©finit une expression faciale de l'avatar VRM.
    
    Args:
        expression_name: "joy", "angry", "sorrow", "fun", "surprised"
        value: IntensitÃ© de 0.0 Ã  1.0
        
    Returns:
        True si commande envoyÃ©e avec succÃ¨s
    """
    # Validation whitelist
    valid_expressions = ["joy", "angry", "sorrow", "fun", "surprised"]
    if expression_name.lower() not in valid_expressions:
        raise ValueError(f"Expression invalide : {expression_name}")
    
    # Clamping 0.0-1.0
    value = max(0.0, min(1.0, value))
    
    # Envoi IPC
    command = {
        "command": "set_expression",
        "data": {
            "name": expression_name.lower(),
            "value": value
        }
    }
    
    return self._send_command(command)

def reset_expressions(self) -> bool:
    """RÃ©initialise toutes les expressions Ã  neutre (0.0)."""
    command = {"command": "reset_expressions"}
    return self._send_command(command)
```

---

## ğŸ“ Structure du projet (essentiel)

```
desktop-mate/
â”œâ”€â”€ main.py                          # Point d'entrÃ©e Python
â”œâ”€â”€ requirements.txt                 # DÃ©pendances Python
â”œâ”€â”€ README.md                        # Doc principale
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ gui/
â”‚   â”‚   â””â”€â”€ app.py                   # Interface Qt (onglets Connection + Expressions)
â”‚   â”œâ”€â”€ ipc/
â”‚   â”‚   â””â”€â”€ unity_bridge.py          # Client TCP + set_expression()
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ config.py
â”‚       â””â”€â”€ logger.py
â”‚
â”œâ”€â”€ unity/
â”‚   â””â”€â”€ DesktopMateUnity/
â”‚       â””â”€â”€ Assets/
â”‚           â”œâ”€â”€ Scripts/
â”‚           â”‚   â”œâ”€â”€ IPC/
â”‚           â”‚   â”‚   â””â”€â”€ PythonBridge.cs          # Serveur TCP
â”‚           â”‚   â”œâ”€â”€ VRMLoader.cs                 # Chargeur VRM
â”‚           â”‚   â””â”€â”€ VRMBlendshapeController.cs   # â­ VERSION 1.6
â”‚           â””â”€â”€ VRM/                 # Package UniVRM 0.127.3
â”‚
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ Mura Mura - Model.vrm        # ModÃ¨le de test
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ docs/sessions/session_6_expressions/       # â­ Documentation Session 6
    â”‚   â”œâ”€â”€ README.md
    â”‚   â”œâ”€â”€ BLENDSHAPES_GUIDE.md
    â”‚   â”œâ”€â”€ UNITY_SETUP_GUIDE.md
    â”‚   â”œâ”€â”€ SESSION_SUCCESS.md
    â”‚   â”œâ”€â”€ FINAL_SUCCESS.md
    â”‚   â”œâ”€â”€ COMPLETE_SUCCESS.md
    â”‚   â””â”€â”€ scripts/
    â”‚       â””â”€â”€ VRMBlendshapeController.cs (copie rÃ©fÃ©rence)
    â””â”€â”€ chat_transitions/
        â”œâ”€â”€ chat_1_python_unity_start_session_0_to_5/
        â””â”€â”€ chat_2_expressions_session_6/  # â­ Chat prÃ©cÃ©dent
            â”œâ”€â”€ CURRENT_STATE.md
            â”œâ”€â”€ CHAT_SUMMARY.md
            â””â”€â”€ prompt_chat2_vers_chat3.txt  # â† Vous Ãªtes ici
```

---

## ğŸ“ LeÃ§ons apprises (CRITIQUE pour Session 7)

### 1. UniVRM a deux APIs distinctes

**CreateFromPreset() :** Pour expressions VRM standard  
â†’ Joy, Angry, Sorrow, Fun, Blink, PhonÃ¨mes (A, I, U, E, O), Look directions

**CreateUnknown() :** Pour expressions custom  
â†’ Surprised, et toutes les expressions non-standard  
â†’ âš ï¸ **Case-sensitive** : "Surprised" â‰  "surprised"

---

### 2. Apply() timing critical

**Pattern Ã  respecter :**
1. `ImmediatelySetValue(key, value)` â†’ Stocke dans buffer
2. `Apply()` immÃ©diat â†’ Flush vers mesh
3. `Apply()` dans LateUpdate() â†’ Garantie rendu chaque frame

Sans les deux appels, expressions peuvent disparaÃ®tre ou ne pas s'afficher.

---

### 3. Unity compilation cache

**SymptÃ´mes :** Code modifiÃ© mais Unity utilise ancienne version

**Solutions :**
1. Version detection logs dans `Start()` : `Debug.Log("[...] VERSION X.Y")`
2. Assets â†’ Refresh (Ctrl+R)
3. Restart Unity
4. En dernier recours : supprimer `Library/ScriptAssemblies/`

---

### 4. Thread-safety Unity

**RÃ¨gle absolue :** Unity API (GameObject, Transform, BlendShapeProxy) **INTERDIT** sur threads secondaires.

**Pattern validÃ© :** Queue<Action> + exÃ©cution dans Update() sur main thread.

UtilisÃ© dans :
- VRMLoader.cs
- VRMBlendshapeController.cs
- PythonBridge.cs (rÃ©seau sur thread sÃ©parÃ©)

---

### 5. GetValue() pour debugging

```csharp
blendShapeProxy.ImmediatelySetValue(key, value);
blendShapeProxy.Apply();

float actualValue = blendShapeProxy.GetValue(key);
Debug.Log($"DemandÃ© : {value:F2} | StockÃ© : {actualValue:F2}");

if (actualValue < 0.01f && value > 0.0f)
{
    Debug.LogWarning("âš ï¸ La clÃ© n'existe pas dans le modÃ¨le !");
}
```

Permet de diagnostiquer si le problÃ¨me vient de :
- La clÃ© inexistante (actualValue == 0)
- L'Apply() timing
- La mÃ©thode CreateFromPreset vs CreateUnknown

---

## ğŸš€ Objectifs Session 7 (ce nouveau chat)

### PrioritÃ© HAUTE : Transitions smooth

**ProblÃ¨me actuel :**
- Changement d'expression instantanÃ© (0% â†’ 100% en 1 frame)
- Visuellement "robotique", pas naturel

**Solution proposÃ©e :** Interpolation linÃ©aire (Lerp)

```csharp
private Dictionary<BlendShapeKey, float> currentValues;
private Dictionary<BlendShapeKey, float> targetValues;
private float transitionSpeed = 2.0f; // Units per second

void Update()
{
    // Lerp vers les valeurs cibles
    foreach (var key in currentValues.Keys.ToList())
    {
        float current = currentValues[key];
        float target = targetValues[key];
        
        float newValue = Mathf.Lerp(current, target, Time.deltaTime * transitionSpeed);
        currentValues[key] = newValue;
        
        blendShapeProxy.ImmediatelySetValue(key, newValue);
    }
}
```

**Modifications nÃ©cessaires :**
- Refactoring `SetExpressionInternal()` pour stocker target au lieu d'appliquer immÃ©diatement
- Ajout dictionnaires currentValues/targetValues
- Lerp dans Update() vers target
- Interface Python : slider "Transition Speed" (0.1s - 2.0s)

---

### PrioritÃ© MOYENNE : Clignements automatiques

**Concept :** Blink alÃ©atoire toutes les 3-5 secondes

**ImplÃ©mentation suggÃ©rÃ©e :**
```csharp
private float nextBlinkTime;
private bool isBlinking = false;

void Start()
{
    nextBlinkTime = Time.time + Random.Range(3f, 5f);
}

void Update()
{
    if (!isBlinking && Time.time >= nextBlinkTime)
    {
        StartCoroutine(BlinkCoroutine());
        nextBlinkTime = Time.time + Random.Range(3f, 5f);
    }
}

IEnumerator BlinkCoroutine()
{
    isBlinking = true;
    BlendShapeKey blinkKey = BlendShapeKey.CreateFromPreset(BlendShapePreset.Blink);
    
    // Fermeture rapide (100ms)
    blendShapeProxy.ImmediatelySetValue(blinkKey, 1.0f);
    blendShapeProxy.Apply();
    yield return new WaitForSeconds(0.1f);
    
    // Ouverture (150ms)
    blendShapeProxy.ImmediatelySetValue(blinkKey, 0.0f);
    blendShapeProxy.Apply();
    isBlinking = false;
}
```

**Interface Python :**
- Checkbox "Auto Blink" (on/off)
- Slider "Blink Frequency" (2-8 secondes entre clignements)

---

### PrioritÃ© BASSE : PrÃ©sets d'Ã©motions

**Concept :** Boutons quick-action dÃ©finissant plusieurs expressions simultanÃ©ment

**Exemples :**
```json
{
  "Happy": {
    "joy": 0.8,
    "fun": 0.5,
    "sorrow": 0.0,
    "angry": 0.0,
    "surprised": 0.0
  },
  "Sad": {
    "joy": 0.0,
    "fun": 0.0,
    "sorrow": 0.9,
    "angry": 0.0,
    "surprised": 0.0
  }
}
```

**Interface Python :**
- Grid de boutons "ğŸ˜Š Happy", "ğŸ˜¢ Sad", "ğŸ˜  Angry", "ğŸ˜ Neutral"
- Bouton "Save Custom Preset"
- Persistance dans config JSON

---

## âš ï¸ Points d'attention critiques

### 1. Ne PAS casser le code VERSION 1.6

Le code VRMBlendshapeController.cs VERSION 1.6 est **FONCTIONNEL**.

**Avant toute modification :**
- CrÃ©er une copie de backup : `VRMBlendshapeController_V1.6_BACKUP.cs`
- Tester chaque changement incrÃ©mentalement
- VÃ©rifier les 5 expressions de base aprÃ¨s chaque modification

---

### 2. VÃ©rifier version au dÃ©marrage Unity

**Toujours inclure version detection log :**
```csharp
void Start()
{
    Debug.Log("[VRMBlendshape] ğŸ­ VERSION 2.0 - SMOOTH TRANSITIONS");
    // ...
}
```

Si le log ne change pas aprÃ¨s modification â†’ Unity utilise ancien .dll â†’ Restart Unity

---

### 3. Thread-safety pour nouvelles fonctionnalitÃ©s

**Coroutines et IPC :**
- `StartCoroutine()` doit Ãªtre appelÃ© sur main thread
- Si commande IPC lance coroutine â†’ passer par Queue<Action>

**Exemple :**
```csharp
// Thread IPC (via PythonBridge)
public void StartAutoBlink(bool enabled)
{
    actionQueue.Enqueue(() => StartAutoBlinkInternal(enabled));
}

// Main thread Unity
private void StartAutoBlinkInternal(bool enabled)
{
    if (enabled)
    {
        StartCoroutine(AutoBlinkLoop());
    }
}
```

---

### 4. Documentation obligatoire

**AprÃ¨s CHAQUE modification :**
- âœ… Mettre Ã  jour `docs/INDEX.md` (nouveaux fichiers)
- âœ… Mettre Ã  jour `docs/README.md` (aperÃ§u gÃ©nÃ©ral)
- âœ… Mettre Ã  jour `docs/CURRENT_STATE.md` (Ã©tat technique)
- âœ… Mettre Ã  jour `README.md` racine (features)
- âœ… CrÃ©er/mettre Ã  jour `docs/sessions/session_7_animations/`

**Rappel utilisateur :**
> "la documentation c'est trÃ¨s important"

Ne JAMAIS dire "TerminÃ©" sans avoir mis Ã  jour la documentation.

---

## ğŸ“š Documentation Ã  consulter

### Documentation Session 6 (rÃ©fÃ©rence)

**Pour comprendre le code actuel :**
- `docs/sessions/session_6_expressions/BLENDSHAPES_GUIDE.md` â†’ API UniVRM dÃ©taillÃ©e
- `docs/sessions/session_6_expressions/SESSION_SUCCESS.md` â†’ ProblÃ¨mes rÃ©solus
- `docs/sessions/session_6_expressions/COMPLETE_SUCCESS.md` â†’ Timeline complÃ¨te + troubleshooting

**Code de rÃ©fÃ©rence :**
- `docs/sessions/session_6_expressions/scripts/VRMBlendshapeController.cs` â†’ VERSION 1.6 complÃ¨te

---

### Documentation transition Chat 2

**Ã‰tat du projet en fin de Chat 2 :**
- `docs/chat_transitions/chat_2_expressions_session_6/CURRENT_STATE.md` â†’ Ã‰tat technique
- `docs/chat_transitions/chat_2_expressions_session_6/CHAT_SUMMARY.md` â†’ RÃ©sumÃ© session

---

## ğŸ› ï¸ Configuration requise

### Environnement de dÃ©veloppement

**Python :**
- Python 3.10+
- PySide6 6.5+
- Virtual environment actif : `desktop-mate/venv/`

**Unity :**
- Unity 2022.3 LTS (URP)
- UniVRM 0.127.3
- Windows 10/11 (64-bit)

**Assets :**
- ModÃ¨le VRM : "Mura Mura - Model.vrm"
- 57 blendshapes sur Face mesh
- Presets : Joy, Angry, Sorrow, Fun, Surprised, Blink, PhonÃ¨mes, Look directions

### Ports rÃ©seau

- **TCP 5555** : Communication IPC Python â†” Unity (localhost)

---

## âœ… Checklist prÃ©-Session 7

**Avant de commencer, vÃ©rifier :**

**Code Unity :**
- [ ] VRMBlendshapeController.cs VERSION 1.6 prÃ©sent
- [ ] Logs Unity montrent "VERSION 1.6 - SURPRISED FIX" au dÃ©marrage
- [ ] Console Unity sans erreurs

**Code Python :**
- [ ] Interface Python avec onglet Expressions
- [ ] 5 sliders fonctionnels
- [ ] Tests unitaires passent : `pytest tests/`

**Tests fonctionnels :**
- [ ] Connexion Python â†’ Unity OK
- [ ] Chargement VRM OK
- [ ] Slider Joy (ğŸ˜Š) modifie le visage
- [ ] Slider Angry (ğŸ˜ ) modifie le visage
- [ ] Slider Sorrow (ğŸ˜¢) modifie le visage
- [ ] Slider Fun (ğŸ˜„) modifie le visage
- [ ] Slider Surprised (ğŸ˜²) modifie le visage
- [ ] Bouton Reset All ramÃ¨ne Ã  neutre

**Si TOUS les points sont cochÃ©s â†’ PrÃªt pour Session 7 ! âœ…**

---

## ğŸ¯ TÃ¢ches immÃ©diates pour Chat 3

### Phase 1 : Diagnostic initial

1. **VÃ©rifier que tout fonctionne encore**
   - Lancer Unity â†’ VÃ©rifier logs VERSION 1.6
   - Lancer Python â†’ Tester les 5 expressions
   - Confirmer aucune rÃ©gression

2. **Lire la documentation Session 6**
   - `BLENDSHAPES_GUIDE.md` pour comprendre API
   - `COMPLETE_SUCCESS.md` pour connaÃ®tre les piÃ¨ges

---

### Phase 2 : Planification Session 7

1. **DÃ©cider de l'ordre des fonctionnalitÃ©s**
   - Transitions smooth en premier ? (RECOMMANDÃ‰)
   - Ou clignements automatiques ?
   - Ou presets d'Ã©motions ?

2. **CrÃ©er dossier documentation**
   - `docs/sessions/session_7_animations/`
   - `docs/sessions/session_7_animations/README.md` (objectifs)

---

### Phase 3 : ImplÃ©mentation

**Pour chaque fonctionnalitÃ© :**
1. âœ… Expliquer le concept Ã  l'utilisateur
2. âœ… Proposer l'architecture technique
3. âœ… Demander confirmation avant de coder
4. âœ… ImplÃ©menter incrÃ©mentalement (petits changements testables)
5. âœ… Tester chaque modification (ne pas tout casser)
6. âœ… Documenter problÃ¨mes + solutions
7. âœ… Mettre Ã  jour INDEX, README, CURRENT_STATE

**Rappel :** L'utilisateur ne connaÃ®t **PAS** Unity ni C#, donc :
- Expliquer clairement chaque concept
- Donner instructions pas-Ã -pas
- Screenshots mentaux ("dans Unity, tu verras...")
- VÃ©rifier comprÃ©hension

---

## ğŸ’¡ Conseils pour le nouveau chat

### Communication avec l'utilisateur

**L'utilisateur :**
- N'est **pas** expert en dÃ©veloppement
- Ne connaÃ®t **pas** Unity ni C#
- A besoin d'**explications claires** et de **guidance**
- ConsidÃ¨re la **documentation trÃ¨s importante**

**Toi (l'IA) :**
- **TOUJOURS** en franÃ§ais ğŸ‡«ğŸ‡·
- **TOUJOURS** expliquer les concepts Unity/C#
- **TOUJOURS** demander confirmation avant changements majeurs
- **JAMAIS** oublier de mettre Ã  jour la documentation

---

### Pattern de rÃ©ponse obligatoire

**AprÃ¨s CHAQUE tÃ¢che terminÃ©e :**
```markdown
âœ… TÃ¢che terminÃ©e !

ğŸ“š **Documentation mise Ã  jour :**
- âœ… docs/INDEX.md â†’ [ce qui a changÃ©]
- âœ… docs/README.md â†’ [ce qui a changÃ©]
- âœ… docs/CURRENT_STATE.md â†’ [ce qui a changÃ©]
- âœ… README.md â†’ [ce qui a changÃ©]
- âœ… docs/sessions/session_7_animations/[fichier].md â†’ [ce qui a changÃ©]

ğŸ¯ **Prochaines Ã©tapes :**
[...]
```

**Si l'utilisateur demande "As-tu mis Ã  jour la documentation ?" â†’ TU AS Ã‰CHOUÃ‰.**

La documentation doit Ãªtre **automatiquement synchronisÃ©e** avec chaque changement de code.

---

### Debugging Unity (si problÃ¨mes)

**Si expressions ne marchent plus aprÃ¨s modification :**

1. **VÃ©rifier logs version :**
   ```
   [VRMBlendshape] VERSION X.Y
   ```
   Si version ancienne â†’ Restart Unity

2. **VÃ©rifier Apply() prÃ©sent :**
   - Dans SetExpressionInternal()
   - Dans LateUpdate()

3. **VÃ©rifier GetValue() :**
   ```csharp
   float actualValue = blendShapeProxy.GetValue(key);
   Debug.Log($"DemandÃ© : {value} | StockÃ© : {actualValue}");
   ```
   Si actualValue == 0 â†’ ClÃ© n'existe pas

4. **VÃ©rifier capitalization :**
   - Presets : `CreateFromPreset(BlendShapePreset.Joy)`
   - Custom : `CreateUnknown("Surprised")` avec majuscule

5. **Dernier recours :**
   - Restaurer backup VERSION 1.6
   - Recommencer les modifications une par une

---

## ğŸ“– Ressources finales

### Fichiers clÃ©s Ã  avoir sous la main

**Code Unity :**
- `unity/DesktopMateUnity/Assets/Scripts/VRMBlendshapeController.cs` (VERSION 1.6)
- `unity/DesktopMateUnity/Assets/Scripts/IPC/PythonBridge.cs`

**Code Python :**
- `src/gui/app.py` (onglet Expressions)
- `src/ipc/unity_bridge.py` (set_expression, reset_expressions)

**Documentation :**
- `docs/sessions/session_6_expressions/COMPLETE_SUCCESS.md` (guide troubleshooting)
- `docs/chat_transitions/chat_2_expressions_session_6/CURRENT_STATE.md`
- `.github/instructions/copilot-instructions.instructions.md` (rÃ¨gles projet)

---

### Instructions systÃ¨me projet

**Fichier :** `.github/instructions/copilot-instructions.instructions.md`

**Contient :**
- Principes de collaboration
- Niveau utilisateur (dÃ©butant Unity/C#)
- Organisation documentation (sessions, INDEX, README)
- SystÃ¨me anti-oubli (checklist prÃ©-finition)
- RÃ¨gles absolues de documentation
- Conventional commits

**Ã€ LIRE en prioritÃ© pour comprendre le workflow du projet.**

---

## ğŸ‰ Bon courage pour Session 7 !

**Ã‰tat de dÃ©part :** âœ… Expressions faciales 100% fonctionnelles  
**Objectif Session 7 :** Animations smooth + clignements automatiques  
**Documentation :** 6 fichiers Session 6 + transition Chat 2 disponibles  
**Code stable :** VRMBlendshapeController.cs VERSION 1.6 validÃ©

**Tu as toutes les ressources pour rÃ©ussir ! ğŸš€**

---

**Date de crÃ©ation de ce prompt :** 19 octobre 2025  
**CrÃ©Ã© par :** Chat 2 (Session 6 - Expressions faciales)  
**Pour :** Chat 3 (Session 7 - Transitions smooth et animations)

**Rappel final :** La documentation c'est **trÃ¨s important** ! ğŸ“š
